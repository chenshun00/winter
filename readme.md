### å¦‚ä½•è¿è¡Œ

*   maven
*   jdk1.8
*   å®‰è£…lombok

å…·ä½“çš„è¿è¡Œæµ‹è¯•å¯ä»¥åœ¨ `top.huzhurong.aop.core.TestUse` ä¸­æ‰¾åˆ°ï¼Œhave a try  ðŸ˜Š

### ç”³æ˜Žå¼äº‹åŠ¡

*   äº‹åŠ¡çš„å¤„ç†æ­¥éª¤
    *   begin/start;(å¼€å¯äº‹åŠ¡)
    *   sql operation;(sqlæ“ä½œ,curd)
    *   exception(å¼‚å¸¸rollback)
    *   success(commit)

> å¦‚ä¸Šå³æ˜¯äº‹åŠ¡çš„å®Œæ•´å¤„ç†æ­¥éª¤ï¼Œè€Œsqlæ“ä½œå½“ä¸­åˆå¯ä»¥ç»†åˆ†ä¸ºå¤šæ¬¡æ“ä½œ(å­äº‹åŠ¡)ï¼Œè¿™æ ·å°±å¯ä»¥è§£å†³ä¿å­˜ç‚¹çš„é—®é¢˜ï¼Œ
æ¯ä¸€ä¸ªå­äº‹åŠ¡éƒ½æ˜¯å®Œæ•´çš„å¯ä»¥ä¸å½±å“çˆ¶äº‹åŠ¡ï¼Œ`innodbçš„å¹³æ¿äº‹åŠ¡æ¨¡åž‹`.

#### å¦‚ä½•å®žçŽ°ç”³æ˜Žå¼äº‹åŠ¡å¤„ç†

æ·»åŠ  `TransactionAdvisor` åˆ‡é¢æ‹¦æˆªå®žçŽ°äº†ç”³æ˜Žå¼äº‹åŠ¡ï¼Œäº‹åŠ¡çš„åŽŸå­æ“ä½œé¢å‘çš„å…¶å®ž `java.sql.Connection`ï¼Œ
å³åªè¦é€šè¿‡æŽ§åˆ¶`å¤šä¸ªService`ä¹‹é—´çš„`Connection`æ˜¯ä¸€ä¸ªå³å¯å®žçŽ°äº‹åŠ¡çš„å®Œæ•´æ“ä½œã€‚

### beanå®žä¾‹åŒ–å¤„ç†é¡ºåº(Springå¤§è‡´å®žçŽ°é¡ºåº)

0ã€åˆ›å»ºbeanå®žä¾‹

1ã€åˆ›å»ºbean,eg:test(å®žä¾‹åŒ–)

2ã€è°ƒç”¨awareæŽ¥å£å®žçŽ°aware(beanFactory)æ³¨å…¥

3ã€beanPostProcessor initå‰ç½®å¤„ç† BeanPostProcessorsBeforeInitialization

4ã€å‰ç½®å¤„ç†å®Œæˆä¹‹åŽï¼Œä¸Šä¸‹æ–‡å®¹å™¨context(ioc å®¹å™¨)æ³¨å…¥

5ã€å¤„ç†InitializingBeanåŽç½®å®žçŽ° afterPropertiesSet,è‡ªå®šä¹‰ init æ–¹æ³•ï¼Œinitæ–¹æ³•åœ¨åŽè¾¹

6ã€beanPostProcessor initåŽç½®å¤„ç† BeanPostProcessorsAfterInitialization,beanå¯¹è±¡å¯èƒ½åœ¨è¿™é‡ŒåŒ…è£…æˆä»£ç†


>ps:å®žåŠ›ä¸å¤Ÿï¼Œæ‰€ä»¥åœ¨Springä¸Šè¿›è¡Œä¸€æ¬¡å˜ç§ï¼Œæžå¤§çš„ç®€åŒ–äº†è¿™ä¸€å±‚é¢çš„æ“ä½œ

### é—®é¢˜
  
1ã€ä½¿ç”¨ `cglib` å’Œ `jdk proxy` çš„æ—¶å€™ï¼Œä¸¤è€…çš„å®žçŽ°åŠ¨æ€ä»£ç†çš„åŽŸç†æ˜¯ä¸ä¸€è‡´çš„ï¼Œ`cglib` ä½¿ç”¨ç»§æ‰¿çˆ¶ç±»çš„çš„å½¢å¼å±•å¼€ï¼Œè¿™æ ·æˆ‘ä»¬å°±å¯ä»¥é€šè¿‡å‘ä¸Š
è½¬åž‹(cast)å°†è¯¥ä»£ç†(å­ç±»)è½¬åž‹ä¸ºçˆ¶ç±»ã€‚è€Œ `jdk proxy` åˆ™é‡‡å–äº†å¦ä¸€ç§å½¢å¼ï¼Œå®žçŽ°ç›¸åŒçš„æŽ¥å£ï¼Œè¿™å°±æ˜¯ä¸ºä»€ä¹ˆ `jdk proxy` ä¸€å®šéœ€è¦æŽ¥å£çš„åŽŸå› ï¼Œå¦‚æžœæ²¡æœ‰æŽ¥å£é‚£ä¹ˆå°±ä»£ç†
å¤±è´¥ï¼Œæ­£å¼å› ä¸ºé€šè¿‡å®žçŽ°æŽ¥å£çš„æ–¹å¼å¯¼è‡´äº†å®ƒåªèƒ½è½¬åž‹ä¸ºå®žçŽ°çš„æŽ¥å£ï¼Œå¦‚æžœè½¬åž‹ä¸ºå­ç±»çš„é‚£ä¹ˆå°±ä¼šå‡ºçŽ°ï¼Œ  `$proxy0 cast xxx.xxx.xx` çš„å¼‚å¸¸ä¿¡æ¯ï¼Œ
å¯ä»¥åˆ°è¿™é‡Œçœ‹çœ‹ `jdk proxy` ç”Ÿæˆçš„ `$proxy0` -----> [$proxy0](https://git.io/fAKeS)  